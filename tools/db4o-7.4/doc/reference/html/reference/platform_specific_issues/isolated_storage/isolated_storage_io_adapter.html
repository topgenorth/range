<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Isolated Storage IO Adapter</title>
    <link rel="stylesheet" type="text/css" href="../../../style.css">
  </head>
  <body>
    <div class="CommonContent">
      <div class="CommonContentArea">
        <h1>Isolated Storage IO Adapter</h1><script>
//We attach this function to a browser object as a variable so that if multiple of these blocks are
//present on the same page, then they will simply over-write eachother with the same function instead
//of generating a naming collision.
window.WikiCodeFormattingCopyToClipboard = function copyToClipboard(sID){
	var sContent = document.getElementById(sID).innerText;
	if( window.clipboardData && clipboardData.setData )
	{
		clipboardData.setData("Text", sContent);
	}
	else
	{
		alert("You must enable javascript access to your clipboard for this feature to work. Please referr to your browser documentation or Google search for instructions.");
	}
}
</script><p><font color="#990000">This topic applies to .NET version only</font>&nbsp;</p>
<p>In order to access Isolated Storage you must use <code>IsolatedStorageFileStream</code>,
which is a class derived from <code>FileStream</code>. db4o by default uses
<a href="../../tuning/performance_hints/randomaccessfileadapter.html" class="wikiLink">RandomAccessFileAdapter</a> or
<a href="../../implementation_strategies/io_adapter/cachedioadapter.html" class="wikiLink">CachedIoAdapter</a> (depending on
version), which under the hood are using <code>FileStream</code> to read and
write db4o database file. As <code>IsolatedStorageFileStream</code> provides
the same interface as <code>FileStream</code> we can use it with a custom IO
adapter to make db4o store its data in the Isolated Storage.</p>

<p>To start with let's take
<code>Db4objects.Db4o.IO.RandomAccessFileAdapter</code> and <code>Sharpen.IO.RandomAccessFile</code> from db4o
source code and modify them to meet our needs. Basicly, we must change all
occurences of <code>FileStream</code> to
<code>IsolatedStorageFileStream</code>, and modify file system function like
create or delete to use Isolated Storage semantics.</p>

<p>First of all let's
create new classes: <code>Db4oIsolatedStorageFile</code> and
<code>IsolatedStorageFileAdapter</code>, and copy the contents of
<code>RandomAccessFile</code> and <code>RandomAccessFileAdapter</code>
accordingly into them.</p>

<p>The constructor for
the new <code>Db4oIsolatedStorageFile</code> needs to be changed like
this:</p>

<span name="cs_wiki_filter" csw_filters="cs">

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">Db4oIsolatedStorageFile.cs: <span class="fscMemberName">Db4oIsolatedStorageFile</span></span></div><div class="fscCode"><pre ID="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/None.gif" align="top"/><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> Db4oIsolatedStorageFile
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Open_Text').style.display='inline';"/>    </span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_41_769_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> IsolatedStorageFileStream _stream;
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        [System.Runtime.InteropServices.DllImport(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">kernel32.dll</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, SetLastError </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">true</span><span style="color: #000000;">)]
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">extern</span><span style="color: #000000;"> </span><span style="color: #0000FF;">int</span><span style="color: #000000;"> FlushFileBuffers(IntPtr fileHandle);
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> Db4oIsolatedStorageFile(String file, String fileMode)
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Open_Text').style.display='inline';"/>        </span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_324_769_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">try</span><span style="color: #000000;">
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Open_Text').style.display='inline';"/>            </span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_354_633_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                IsolatedStorageFile isf </span><span style="color: #000000;">=</span><span style="color: #000000;"> IsolatedStorageFile.GetUserStoreForAssembly();
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                _stream </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> IsolatedStorageFileStream(file, FileMode.OpenOrCreate,
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                    fileMode.Equals(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">rw</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">) </span><span style="color: #000000;">?</span><span style="color: #000000;"> FileAccess.ReadWrite : FileAccess.Read, isf);
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>            }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">16</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">catch</span><span style="color: #000000;"> (IOException x)
</span><span style="color: #008080;">17</span><span style="color: #000000;"><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Open_Text').style.display='inline';"/>            </span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">...</span><span id="..IsolatedStorageCS.ZipsDb4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile.Cs_Db4oIsolatedStorageFile_1509_89_680_759_Open_Text"><span style="color: #000000;">{
</span><span style="color: #008080;">18</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">throw</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> DatabaseFileLockedException(file, x);
</span><span style="color: #008080;">19</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>            }</span></span><span style="color: #000000;">
</span><span style="color: #008080;">20</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        }</span></span></span></div></pre></div></div>

</span>

<span name="cs_wiki_filter" csw_filters="vb">

<div class="FormattedSourceCode"><div class="fscHeader"><span class="fscFileName">Db4oIsolatedStorageFile.vb: <span class="fscMemberName">Db4oIsolatedStorageFile</span></span></div><div class="fscCode"><pre ID="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89"><div><!--

Code highlighting produced by Actipro CodeHighlighter (freeware)
http://www.CodeHighlighter.com/

--><span style="color: #008080;">01</span><img id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Open_Text').style.display='inline';"/><span style="color: #0000FF;">Public</span><span style="color: #000000;"> </span><span id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Class Db4oIsolatedStorageFile</span><span id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_7_756_Open_Text"><span style="color: #0000FF;">Class</span><span style="color: #000000;"> Db4oIsolatedStorageFile
</span><span style="color: #008080;">02</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #0000FF;">Private</span><span style="color: #000000;"> _stream </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IsolatedStorageFileStream
</span><span style="color: #008080;">03</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">04</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>        </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">System.Runtime.InteropServices.DllImport(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">kernel32.dll</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, SetLastError:</span><span style="color: #000000;">=</span><span style="color: #0000FF;">True</span><span style="color: #000000;">)</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> _
</span><span style="color: #008080;">05</span><span style="color: #000000;"><img id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Open_Text').style.display='inline';"/>        </span><span style="color: #0000FF;">Private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Shared</span><span style="color: #000000;"> </span><span id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Function FlushFileBuffers()</span><span id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_203_288_Open_Text"><span style="color: #0000FF;">Function</span><span style="color: #000000;"> FlushFileBuffers(</span><span style="color: #0000FF;">ByVal</span><span style="color: #000000;"> fileHandle </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IntPtr) </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Integer</span><span style="color: #000000;">
</span><span style="color: #008080;">06</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockEnd.gif" align="top"/>        </span><span style="color: #0000FF;">End Function</span></span><span style="color: #000000;">
</span><span style="color: #008080;">07</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>
</span><span style="color: #008080;">08</span><span style="color: #000000;"><img id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Open_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedSubBlockStart.gif" align="top" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Open_Text').style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Closed_Image').style.display='inline'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Closed_Text').style.display='inline';"/><img id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Closed_Image" src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ContractedSubBlock.gif" align="top" style="display: none;" onClick="this.style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Closed_Text').style.display='none'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Open_Image').style.display='inline'; document.getElementById('..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Open_Text').style.display='inline';"/>        </span><span style="color: #0000FF;">Public</span><span style="color: #000000;"> </span><span id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Closed_Text" style="border: solid 1px #808080; background-color: #FFFFFF; display: none;">Sub New()</span><span id="..IsolatedStorageVB.ZipsDb4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile.Vb_Db4oIsolatedStorageFile_1662_89_305_756_Open_Text"><span style="color: #0000FF;">Sub</span><span style="color: #000000;"> </span><span style="color: #0000FF;">New</span><span style="color: #000000;">(</span><span style="color: #0000FF;">ByVal</span><span style="color: #000000;"> file </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> </span><span style="color: #0000FF;">String</span><span style="color: #000000;">, </span><span style="color: #0000FF;">ByVal</span><span style="color: #000000;"> fMode </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> </span><span style="color: #0000FF;">String</span><span style="color: #000000;">)
</span><span style="color: #008080;">09</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">Try</span><span style="color: #000000;">
</span><span style="color: #008080;">10</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">Dim</span><span style="color: #000000;"> isf </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IsolatedStorageFile </span><span style="color: #000000;">=</span><span style="color: #000000;"> IsolatedStorageFile.GetUserStoreForAssembly()
</span><span style="color: #008080;">11</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                _stream </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">New</span><span style="color: #000000;"> IsolatedStorageFileStream(file, FileMode.OpenOrCreate, </span><span style="color: #0000FF;">IIf</span><span style="color: #000000;">(fMode.Equals(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">rw</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">), FileAccess.ReadWrite, FileAccess.Read), isf)
</span><span style="color: #008080;">12</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">Catch</span><span style="color: #000000;"> x </span><span style="color: #0000FF;">As</span><span style="color: #000000;"> IOException
</span><span style="color: #008080;">13</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>                </span><span style="color: #0000FF;">Throw</span><span style="color: #000000;"> </span><span style="color: #0000FF;">New</span><span style="color: #000000;"> DatabaseFileLockedException(file, x)
</span><span style="color: #008080;">14</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/InBlock.gif" align="top"/>            </span><span style="color: #0000FF;">End</span><span style="color: #000000;"> </span><span style="color: #0000FF;">Try</span><span style="color: #000000;">
</span><span style="color: #008080;">15</span><span style="color: #000000;"><img src="../../../Utility/ActiPro.CodeHighligher/OutliningIndicators/ExpandedBlockEnd.gif" align="top"/>        </span><span style="color: #0000FF;">End Sub</span></span></span></div></pre></div></div>

</span>



<p>The rest of <code>Db4oIsolatedStorageFile</code> copies the
syntax of the <code>RandomAccessFile</code>. The result of the modification can be reviewed
here: <a href="db4oisolatedstoragefile.html" class="wikiLink">Db4oIsolatedStorageFile</a>.</p>
<p>In the IsolatedStorageFileAdapter we will need to make the
following changes:</p>

<ul>
<li>change
     the references of RandomAccessFile to Db4oIsolatedStorage file
     (constructor and Open method);</li>
<li>remove
     LockFile and UnlockFile method calls (constructor and Close method);</li>
<li>remove
     the call to translate file path to canonical path from the constructor;</li>
<li>modify
     Delete and Exists methods to use the Isolated Storage instead of file
     system.</li>
</ul>


<p>The result of the
modification can be reviewed here: <a href="isolatedstoragefileadapter.html" class="wikiLink">IsolatedStorageFileAdapter</a>.</p>
<p>The
<a href="isolated_storage_example.html" class="wikiLink">next topic</a> will show a small example of db4o
usage over isolated storage.</p></div>
    </div>
    <div id="footer">
					This revision (3) was last Modified 2007-08-19T13:36:48 by Tetyana.
				</div>
  </body>
</html>